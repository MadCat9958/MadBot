# Changelog

## Версия `1.4.1`
- Дата выпуска: Неизвестно

### Добавлено:
- Получение стикера, отправленного пользователем, через контекстное меню.
- Синхронизация слеш-команд после запуска, используя флаг `--sync`.

### Исправлено:
- Отправка вебхука об повышении бота пользователем, если он это делает впервые.
- Работа `/tic-tac-toe` (странно, что абсолютно никто не жаловался, хотя не раз натыкались на эту ошибку).

## Благодарности:
- [TheMisterSenpai](https://github.com/TheMisterSenpai) за находку бага с вебхуком.

## Версия `1.4`
- Дата выпуска: 06.05.2024

### Добавлено:
- Логирование комментариев и повышений бота на Boticord в канале #・ботикорд.
- Напоминалка о повышении бота.
- Глобальный handler, который обрабатывает каждое уведомление от Boticord (даже если для него есть свой отдельный handler). Используется для отладки (`--debug`).
- Счётчик повышений бота на Boticord в оповещении о новом бампе.
- Отладочный режим получения уведомлений от вебсокета Boticord.
- Снятие задержки на использование команд бота за повышение на Boticord.
- Изменение заполнителя меню выбора в `/buttonrole`.

### Изменено:
- Использование ID бота от вебсокета Boticord, чтобы исключить появление неверной ссылки при запуске кода бота через другое приложение.
- В `/botinfo` статистика будет обновляться каждый раз, когда пользователь её выбирает в меню выбора.

### Исправлено:
- Отправка уведомлений о выдаче наказаний в личные сообщения участников.
- Проверки на возможность бана пользователя Discord, которого нет на сервере.

### Удалено:
- Отключение задачи на отправку статистики на Boticord в файле `cogs/boticord/websocket.py` из-за переноса задачи в отдельный ког.
- Зависимость от `boticordpy`. Однако, текущий переписанный код, всё равно основан на этой библиотеке.

## Версия `1.3`
- Дата выпуска: 17.03.2024

### Добавлено:
- Программа предварительного тестирования. Подробнее - на сервере поддержки бота.
- Отображение ID шарда сервера в `/getdebug`.
- Новый флаг загрузки бота: `--db-suffix`
    - Теперь можно поставить суффикс к текущему названию базы данных бота. Это может быть полезно, если на одном сервере MongoDB запущено несколько ботов, но они не должны мешать друг другу.
- Изменение выдачи ролей через контекстное меню.
    - Изменить выдачу может каждый, кто имеет право на управление ролями.
    - Изменить можно выдаваемые роли и эмбед.

### Изменено:
- `/userinfo` переписан с нуля
    - Изменён дизайн.
    - Значки перенесены в отдельное поле.
    - Также убраны некоторые лишние значки.
    - Отображение цвета никнейма пользователя в HEX формате.
    - Отображение времени размута в `/userinfo`.
    - Отображение первых 15 ролей пользователя и кол-во ролей всего у человека.
    - Просмотр разрешений пользователя на сервере.
    - Возможность использовать команду в личных сообщениях или на пользователях, которых нет на сервере.
- Изменения в `/serverinfo`
    - Значки перенесены в отдельное поле.
    - Код команды был немного переписан для лучшего вида.
    - Убраны ненужные значки.
- Выбор канала для клонирования в `/clone`. Раньше клонировался канал, в котором находится пользователь.
- Команды в `/help` теперь сортируются в алфавитном порядке (вау).
- Предпросмотр в `/buttonrole` теперь отображается сверху.
- Также роли для выдачи в `/buttonrole` теперь сортируются в алфавитном порядке.

### Исправлено:
- Баги с командами статистики, из-за чего пользоваться ею было невозможно.
- Отображение статуса бота при малом количестве серверов.
- Отсутствие таймштампов в логировании в файл.

### Удалено:
- Давно неактуальная зависимость от библиотеки `qrcode`.
- Логирование созданных пользователями эмбедов в `/buttonrole`.
- Неиспользуемая работа с NeppedAPI.

## Версия `1.2.2`
- Дата выпуска: в разработке

### Добавлено:
- Диллема о нумерации версий.

### Изменено:
- Опять перепись `/buttonrole`.
    - Исправлена проблема с поломкой меню выбора при неудачном выборе ролей. Теперь не надо снова прописывать команду.
    - Добавлены значения по умолчанию. Вам теперь не надо вручную вводить что-то. Бот уже подставил значения.
        - Ничто не мешает удалить их и записать туда что-то своё.
    - Добавлен предпросмотр эмбеда, который у Вас получается на данным момент. В планах: добавить возможность изменить эмбед, не создавая выбор ролей по-новой.
    - Добавлена кнопка вызова заполнения эмбеда после выбора ролей.
        - В сообщении также отображаются выбранные роли, что даёт возможность убедиться, что пользователь ничего не забыл или не выбрал лишнего.
- Полный перенос функций файла `cogs/tools.py` по файлам в папке `cogs/tools/`.
- Переименование `/ball` в `/8ball`.
- Переименование `/send` в `/sendwebhook`.
- Переименование `/debug` в `/getdebug`.

### Исправлено:
- Вызов функций `is_premium*` со значением `discord.Client`, которое было убрано из необходимых. 

### Удалено:
- Файл `cogs/tools.py`. Почему? Ответ выше.

## Версия `1.2.1`
- Дата выпуска: 17.12.2023

### Добавлено:
- Проверка на возможность подключения к базе данных ([Issue #19](https://github.com/Team-MadBot/MadBot/issues/19)).
- Возможность включить режим отладки. Логирование переходит в режим DEBUG, а бот использует тестовую базу данных.
- Возможность запустить миграцию базы данных перед запуском бота.

### Изменено:
- Работа с базой данных. Теперь используется асинхронная библиотека для MongoDB `motor`.
    - Переписаны некоторые функции с работы в синхронности на асинхронность.
- Некоторые штуки были вынесены из `main.py` в отдельные файлы.

### Удалено:
- "Star imports" в некоторых местах.

===================================================

## Версия `1.2`
- Дата выпуска: 03.12.2023

### Добавлено:
- Модерационные команды

### Изменено:
- `requests` запросы переписаны на `aiohttp`.
- `/buttonrole` переписан. Теперь вместо необходимости страдать, указывая в правильном порядке роли для выдачи в слеш-команде, будет работать меню для выбора ролей. У - удобство.
- В `/botinfo` теперь используется библиотека, которая определяет дистрибутив на основе ядра Linux.
- Статистика бота теперь не будет (не должна) сбрасываться после перезагрузки.
- Теперь участники, занесённые в чёрный список, будут видеть причину занесения и срок (если указано).
- Использование `app_commands.Range` вместо проверки на длину аргумента вручную. Теперь Вам банально Discord не даст нарушить лимиты длины строки или числа.
- Команда `mad.debug` и некоторые команды из `cogs/tools.py` перенесены в отдельные коги.
- Произошло избавление от нескольких `MongoClient()` в разных кусках кода.

### Убрано:
- Команды `/ping`, `/outages` и `/version`.
- Куски кода, отвечающие за проведение голосования.

====================================================

**Версия `0.10.1`** (выпущена 06.06.2022)

- Фиксы багов с `/autorole`.
- Косметические изменения `/botinfo`.
- Новая категория - Реакции.
- Изменение вида `/autorole`.
- Экстренные изменения из-за приближения лимита серверов.
- Ответ пользователю на неработающий компонент.

**Версия `0.10`** (выпущена 31.05.2022)

- Добавление `/russian-roulette` и `/duel`.
- Использование кнопок-ссылок в `/botinfo`.
- Добавлена страница бота на Boticord в `/botinfo`.
- Добавлено угадывание числа (`/number`).
- Улучшение статистики `/botinfo`.
- При ошибке, кнопки сообщения будут убраны.
- Предосторожности в `/weather`.
- Добавлена команда `/autorole` для настройки ролей на нажатие кнопок.
- Добавлена команда `/dice`.
- Изменение сообщения о кулдауне.

============================================

**Версия `0.9`** (выпущена 25.05.2022 в 21:00)

- Исправление бага со счётом команд в `/botinfo`.
- Добавлены полезная команда `/stopwatch`.
- Добавлена развлекательная команда `/knb`, `/coin`.
- Команда `/base64` теперь - группа.
- Добавлена команда `/debug` для получения сведений о боте.
- Команда `/idea` теперь в кулдауне (раз в 5 минут).
- Учет embed'ов и файлов в док-вах в контекстных меню.
- Добавлена обратная связь через `/help`. ~~Конец `/idea`?~~
- Новый значок - помощник разработчика.
- Добавлена игра `/tic-tac-toe`. Спасибо, F_Artamon#7588.
- Добавлена игра `/hangman`.

==============================================

**Версия `0.8`** (выпущена 17.05.2022 в 20:00)

- Требование права на просмотр журнала аудита в `/getaudit`.
- Показ кол-во участников в сети в `/serverinfo`.
- Изменение вида `/serverinfo`.
- Добавление Select Menu в `/userinfo` и `/serverinfo`.
- Команды могут быть отключены владельцем бота.
- Добавлено новое развлечение: `/doors`.
- Использование кнопок и форм вместо реакций и сообщений.
- Добавлена команда `/weather`.
- Иногда, бот будет показывать свою версию в статусе.
- Добавлена команда `/ball`.
- Обновлен дизайн `/botinfo` и `/help`.

==============================================

**Версия `0.7`** (выпущена 08.05.2022 в 19:30)

- Исправлена команда `/base64`.
- Обновлен дизайн `/botinfo` и `/avatar`.
- Запрос на смену ника при отсутствии права на изменение никнейма в `/nick`.
- Небольшое дополнение команды `/nsfw`.
- Авто-постинг новостей из #github.
- Показ типа операционной системы, на которой запущен бот, в `/botinfo`.
- Показ списка ролей сервера в `/serverinfo`.
- Теперь приветственное сообщение будет присылаться в ЛС добавившему бота, если это возможно.
- Команда `/outages` снова работает.
- При правильном ответе, бот пишет время ответа в `/math`.
- Добавлена команда `/clearoff`.
